name: Start App Service

on:
  workflow_call:
    inputs:
      appName:
        required: true
        type: string
        description: "Name of the app service"
      resourceGroupName:
        required: true
        type: string
        description: "Resource group containing the app service"
      environment:
        required: true
        type: string
        description: "Environment (dev, qa, prod)"
      type:
        required: true
        type: string
        description: "Type of the app service (webapp, functionapp)"
    secrets:
      AZURE_CREDENTIALS:
        required: true
        description: "Azure credentials for authentication"

jobs:
  start-app-service:
    runs-on: ubuntu-latest
    steps:
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
      
      - name: Start App Service
        uses: azure/CLI@v1
        with:
          inlineScript: |
            echo "Starting ${{ inputs.type }} ${{ inputs.appName }} in ${{ inputs.resourceGroupName }} (${{ inputs.environment }})"
            if [ "${{ inputs.type }}" == "webapp" ]; then
              az webapp start --name ${{ inputs.appName }} --resource-group ${{ inputs.resourceGroupName }}
            elif [ "${{ inputs.type }}" == "functionapp" ]; then
              az functionapp start --name ${{ inputs.appName }} --resource-group ${{ inputs.resourceGroupName }}
            else
              echo "Unsupported app type: ${{ inputs.type }}"
              exit 1
            fi
            echo "App service started successfully"
      
      # Removed artifact upload step to fix runner issues